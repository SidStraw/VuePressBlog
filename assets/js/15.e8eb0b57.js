(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{391:function(t,s,a){"use strict";a.r(s);var n=a(8),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_17-github-actions-的-workflow-設定檔解析-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17-github-actions-的-workflow-設定檔解析-2"}},[t._v("#")]),t._v(" 17. GitHub Actions 的 Workflow 設定檔解析（2）")]),t._v(" "),a("h1",{attrs:{id:"github-actions-的-workflow-設定檔解析-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-的-workflow-設定檔解析-2"}},[t._v("#")]),t._v(" GitHub Actions 的 Workflow 設定檔解析（2）")]),t._v(" "),a("p",[t._v("在上一篇文章說明了 Workflow 的名稱與觸發條件的設置，今天就來分析 "),a("code",[t._v("jobs")]),t._v(" 的部分吧。")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"jobs-確切執行的動作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jobs-確切執行的動作"}},[t._v("#")]),t._v(" "),a("code",[t._v("jobs")]),t._v(" 確切執行的動作")]),t._v(" "),a("p",[t._v("上一篇有提到：")]),t._v(" "),a("blockquote",[a("p",[t._v("不過在我的範例中因為專案相當單純，網站樣式等等目前也是使用已完成開發的主題，所以網站專案的本體其實主要都是 .md 等內容，我認為也沒有必要在發表新文章、新消息等文件增減的狀況下安排測試，因此工作流就簡化成一組 build 囉。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build and deploy gh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# jobs 的名稱，正確命名才能方便狀況發生時的排查")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MY_SECRET")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("secrets.commit_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PUBLISH_DIR")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .vuepress/dist\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 設置環境變數，先定義好腳本使用的變數")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 設置腳本運行時的 Docker base-image")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matrix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("10.x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以設置一組陣列，在本工作流中會自動用類似迴圈的方式重複注入 steps 進行運作")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 這邊的範例中只有使用一組內容，所以 steps 只會進行一次動作")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 而 steps 中的  ${{ matrix.node-version }} 就會依序注入陣列中的值")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-----------------------------------------------------------------------")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Use Node.js $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" matrix.node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("version "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" matrix.node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("version "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" borales/actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("yarn@v2.0.0\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# will run `yarn install` command")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" borales/actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("yarn@v2.0.0\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# will run `yarn build` command")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Commit files\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n        echo ${{secrets.DEPLOY_PASSWORD}} | sudo -S chown -R $USER:$USER $PUBLISH_DIR\n        cd $PUBLISH_DIR\n        git init\n        git config --local user.email "action@github.com"\n        git config --local user.name "GitHub Action"\n        git status\n        git remote add origin <https://$MY_SECRET@github.com/$GITHUB_REPOSITORY.git>\n        git checkout -b gh-pages\n        git add --all\n        git commit -m "deploy to Github pages"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Push changes\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ad"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("m/github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github_token")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITHUB_TOKEN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gh-pages'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.vuepress/dist'")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"steps-是工作流的實際動作命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#steps-是工作流的實際動作命令"}},[t._v("#")]),t._v(" "),a("code",[t._v("steps")]),t._v(" 是工作流的實際動作命令")]),t._v(" "),a("p",[t._v("本例中，動作概述上就是：")]),t._v(" "),a("ol",[a("li",[t._v("使用 "),a("code",[t._v("actions/checkout@v2")]),t._v(" 來設置 GitHub Actions 的相關環境")]),t._v(" "),a("li",[t._v("設置使用的 Node.js 版本")]),t._v(" "),a("li",[t._v("使用 "),a("code",[t._v("yarn")]),t._v(" 指令")]),t._v(" "),a("li",[t._v("為編譯輸出的內容打上 "),a("code",[t._v("commit")]),t._v(" 版本")]),t._v(" "),a("li",[t._v("將編譯內容推送至 GitHub Pages 使用的 "),a("code",[t._v("gh-pages")]),t._v(" 分支")])])])}),[],!1,null,null,null);s.default=e.exports}}]);